# wildermesser_microservices
# Docker
## Базовые вещи
Запущены контейнеры hello-world и ubuntu:16.04 командо `docker run`. Содержимое одного контейнера изменено, повторный запуск команды создаёт новый контейнер без внесённых изменений. Изменения сохранены в образе командой `docker commit`. Проверн запуск команды внутри контейнера с помощью `docker exec`. Остановлены и удалены все используемые контейнеры. Удалены все образы.
## Изоляция
По умолчанию контейнеры максимально изолированы от хостовой системы. Однако, в случае необходимости доступа к каким-то ресурсам хоста, можно выключить какой-либо механизм изоляции: pid, net, user. Например, опция `--pid` позволяет в контейнере увидеть процессы хоста
## Docker-machine
Предоставляет удобный способ использования удалённого демона docker для локального управления и запуска контейнеров. После настройки достаточно в текущем терминале выполнить `eval $(docker-machine env docker-host)` и пользоваться Docker как-будто он установлен локально.
## Dockerfile
Позволяет описать в файле построение нового Docker образа. Должен базироваться на каком-то созданном заранее образе. Затем должна быть задана последовательность команд, выполняемых для построения образа. После выполнения каждой команды создаётся новый слой, чтобы проще было переиспользовать. Это повдение можно отключить. В образ можно копировать локальные или удалённые файлы. Так же обязательно задать команду, которая будет выполняться при старте контейнера и получил PID=1.
## Docker hub
Публичный registry образов Docker. Можно добавлять свои образы и затем использовать в проектах.
## Оптимизация dockerfile
- Взять за основу минимальй образ типа apline
- Все наиболее часто изменяемые сущности указывать как можно ниже в Dockerfile
- Очищать контейнер от временных данные сборки
- Использовать multi-stage
## Взаимосвязь контейнеров
Чтобы контейнеры могли обмениваться данным по сети, необхоимо создать сеть командой `docker network`, затем использовать эту сеть при запуске контейнеров. Аналогом DNS имён являются `network aliases`. Каждый контейнер может иметь их несколько. Удобно на эти имена внутри контейнера ссылатья через переменные окружения. Их можно будет изменить с помощью опции `-e`.
## Сети в Docker
При старте контейнера можно задать используемую сеть. Существует несколко типов сетей:
- none
- host
- bringe*
- MACVLAN
- overlay
У каждой существут свои настройки, bridge по улмолчанию. В brigde можно использовать встроенный Serice Discovery. По умолчанию создаётся запись в DNS с именем контейнера и ip адресом. Также можно использовать aliases для задания дополнительных имён внутри одной bridge сети. При старте контейнера можно укзатаь только одну сеть, поэтому присоединение к дополнительной сети осуществляется командой `docker network connect`
## Docker-compose
Позволяет в yaml файле описать запуск одного или более контейнера. А так же описать используемые сети и volumes. Поддерживает переменные окружения для дополнительной параметризации. По умолчанию значения переменных берутся из `.env` файла. Задание базового имени проекта, на основе которого называются остальные сущности, такие как контейнеры, сети и т.д. осуществляется через параметр `-p` или переменную окружения `COMPOSE_PROJECT_NAME`
## Docker-compose override
Возможно переопределить часть кода из docker-compose файла и в момен запуска "слить" эти данные. По умолчанию берётся файл docker-compose.override.yml, однако можно указать свой через опцию `-f`. В том числе таких файлов может быть несколько. Актуальными становятся данные, определённый в последнем файле при конфликте.
Чтобы дать возможность редактировать данные в запущеном контейнере, можно создать новый `volume` указав на нужную директорию внутри контейнера. В такмо случае при старте содержимое данной директории будет скопировано в папку volume'a (по умолчанию `/var/lib/docker/volumes/имя_volume`), а затем эта директория будет примонтирована в контейнер.
